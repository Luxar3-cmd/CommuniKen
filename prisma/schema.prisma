// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                        Int                @id @default(autoincrement())
  direccion_correo          String             @unique
  descripcion               String?            // Campo opcional
  fecha_creacion            DateTime           @default(now())
  fuente_preferida          String?
  correosEnviados           Correo[]           @relation("CorreoRemitente")
  correosRecibidos          Correo[]           @relation("CorreoDestinatario")
  direccionesBloqueadas     DireccionBloqueada[]
  direccionesFavoritas      DireccionFavorita[]
  publicidades              Publicidad[]
  temasCorreo               TemaCorreo[]
  versionSoftware           VersionSoftware[]
}

model Correo {
  id                Int                @id @default(autoincrement())
  remitente_id      Int
  destinatario_id   Int
  asunto            String
  cuerpo            String
  fecha_envio       DateTime?
  leido             Boolean
  es_favorito       Boolean
  color_fondo       String?
  animacion_id      Int?
  publicidad_id     Int?

  remitente         Usuario            @relation("CorreoRemitente", fields: [remitente_id], references: [id])
  destinatario      Usuario            @relation("CorreoDestinatario", fields: [destinatario_id], references: [id])
  animacion         Animacion?         @relation(fields: [animacion_id], references: [id])
  publicidad        Publicidad?        @relation(fields: [publicidad_id], references: [id])
  estilos_firma     EstiloFirma[]
}

model EstiloFirma {
  id                Int                @id @default(autoincrement())
  nombre_estilo     String
  fuente            String
  correo_id         Int

  correo            Correo             @relation(fields: [correo_id], references: [id])
  pluginCorreo      PluginCorreo?
}

model DireccionBloqueada {
  id                   Int                @id @default(autoincrement())
  usuario_id           Int
  direccion_bloqueada  String
  fecha_bloqueo        DateTime
  version_software_id  Int?

  usuario              Usuario            @relation(fields: [usuario_id], references: [id])
  versionSoftware      VersionSoftware?   @relation(fields: [version_software_id], references: [id])
}

model DireccionFavorita {
  id                   Int                @id @default(autoincrement())
  usuario_id           Int
  direccion_favorita   String
  fecha_agregado       DateTime
  categoria            String?

  usuario              Usuario            @relation(fields: [usuario_id], references: [id])
}

model Publicidad {
  id                   Int                @id @default(autoincrement())
  contenido_anuncio    String
  fecha_mostrado       DateTime
  usuario_id           Int
  animacion_id         Int?

  usuario              Usuario            @relation(fields: [usuario_id], references: [id])
  animacion            Animacion?         @relation(fields: [animacion_id], references: [id])
  correos              Correo[]
}

model Animacion {
  id                   Int                @id @default(autoincrement())
  nombre               String
  duracion_segundos    Int
  tema_correo_id       Int?

  temasCorreo          TemaCorreo?        @relation(fields: [tema_correo_id], references: [id])
  publicidades         Publicidad[]
  correos              Correo[]
}

model TemaCorreo {
  id                   Int                @id @default(autoincrement())
  nombre_tema          String
  usuario_creador_id   Int
  plugin_correo_id     Int?

  usuario              Usuario            @relation(fields: [usuario_creador_id], references: [id])
  pluginCorreo         PluginCorreo?      @relation(fields: [plugin_correo_id], references: [id])
  animaciones          Animacion[]
}

model PluginCorreo {
  id                   Int                @id @default(autoincrement())
  nombre_plugin        String
  correos_afectados    String
  idiomas_soportados   String
  estilo_firma_id      Int?               @unique

  estiloFirma          EstiloFirma?       @relation(fields: [estilo_firma_id], references: [id])
  temasCorreo          TemaCorreo[]
}

model VersionSoftware {
  id                   Int                @id @default(autoincrement())
  nombre_version       String
  fecha_lanzamiento    DateTime
  usuario_asociado_id  Int?

  usuario              Usuario?           @relation(fields: [usuario_asociado_id], references: [id])
  direccionesBloqueadas DireccionBloqueada[]
}
